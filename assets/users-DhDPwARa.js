import{r as g,av as re,u as oe,a as ne,i as ue,d as ie,n as de,f as me,g as s,h as t,q as u,v as i,V as p,t as m,ap as b,j as n,am as N,an as pe,aq as j,p as ce,U as ve,ar as B,as as L,F as fe,y as ge}from"./index-CQzQsxwH.js";import{c as Ve,a as _,b as we,u as ke,e as V}from"./index.esm-BK4_TKQg.js";import{v as z}from"./index-5Ae29Jgt.js";import{b as G}from"./route-block-B_A1xBdJ.js";import{V as S,a as w}from"./VRow-b9ERMt92.js";import{V as be}from"./VDataTable-t5fLSXSI.js";import{V as J}from"./VContainer-n6X1xjUR.js";import{V as _e}from"./VForm-XPVn3mHC.js";import{V as O}from"./VSelect-BetZeEYB.js";import"./VPagination-BDy9tnmG.js";import"./VMenu-3VexAR-I.js";import"./VChip-DjCs4g7X.js";import"./VDivider-ClWHWc5e.js";import"./VList-clb74CIf.js";const xe={class:"text-center mb-5"},ye={class:"d-flex"},he={class:"mt-3 mr-5"},$e={class:"d-flex"},Ce={class:"mt-3 mr-13"},Ae={class:"d-flex"},Ue={class:"mt-3 mr-13"},Ee={class:"d-flex"},qe={class:"mt-3 mr-13"},De={class:"d-flex"},Ie={class:"mt-3 mr-13"},Re={class:"d-flex"},Se={class:"mt-3 mr-13"},Te={__name:"users",setup(Fe){const q=g(""),v=re([]),{t:r}=oe(),{apiAuth:x}=ge(),D=ne(),f=ue(),H=[{title:r("admin.userId"),key:"_id",sortable:!0},{title:r("admin.userName"),key:"name",sortable:!0},{title:r("admin.userGender"),key:"gender",sortable:!0},{title:r("admin.userAge"),key:"age",sortable:!0},{title:r("admin.userEmail"),key:"email",sortable:!0},{title:r("admin.userRole"),key:"role",sortable:!0},{title:"",key:"edit",sortable:!1},{title:"",key:"delete",sortable:!1}],d=g({open:!1,id:""}),c=g({open:!1,data:""}),K=e=>{c.value.open=!0,c.value.data=e},T=e=>{e==="cancel"?c.value.open=!1:e==="confirm"&&(Y(c.value.data),c.value.open=!1)},F=async e=>{e&&(d.value.id=e._id,$.value.value=e.name,k.value.value=e.account,C.value.value=e.email,A.value.value="*****",E.value.value=e.age,U.value.value=e.gender,I.value=e.image||`http://api.multiavatar.com/${k.value.value}.png`),d.value.open=!0},P=()=>{d.value.open=!1,d.value.id="",ae(),y.value=null,h.value=null},I=g("http://api.multiavatar.com/bbb.png"),y=g(null),h=g(null),Q=()=>{y.value.click()},W=async()=>{try{const e=y.value.files[0];if(!e)return;if(!["image/jpeg","image/png"].includes(e.type))throw new Error("userImageInvalid");if(e.size>1024*1024)throw new Error("userImageMaxSize");I.value=URL.createObjectURL(e),h.value=e}catch(e){console.log(e),f({text:r("admin."+(e.message||"unknownError")),snackbarProps:{color:"red"}})}},X=e=>{if(e===0)return r("admin.userRoleUser");if(e===1)return r("admin.userRoleMember");if(e===2)return r("admin.userRoleAdmin")},R=async()=>{var e,a;try{const{data:l}=await x.get("/user/all");v.push(...l.result),v.find(o=>{o._id===D.id&&(D.setAvatar(o.image),D.setNickname(o.name))})}catch(l){console.log(l),f({text:r("api."+(((a=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:a.message)||"unknownError")),snackbarProps:{color:"red"}})}};R();const Y=async e=>{var a,l;try{await x.delete("/user/"+e._id),v.length=0,await R(),f({text:r("admin.groupDeleted"),snackbarProps:{color:"green"}})}catch(o){console.log(o),f({text:r("api."+(((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)||"unknownError")),snackbarProps:{color:"red"}})}},Z=Ve({name:_().required(r("api.userNameRequired")),account:_().required(r("api.userAccountRequired")).min(4,r("api.userAccountTooShort")).max(20,r("api.userAccountTooLong")).test("isAlphanumeric",r("api.userAccountInvalid"),e=>z.isAlphanumeric(e)),email:_().required(r("api.userEmailRequired")).test("isEmail",r("api.userEmailInvalid"),e=>z.isEmail(e)),password:_().required(r("api.userPasswordRequired")).min(4,r("api.userPasswordTooShort")).max(20,r("api.userPasswordTooLong")),gender:_().required(r("api.userGenderRequired")),age:we().required(r("api.userAgeRequired"))}),{handleSubmit:ee,isSubmitting:M,resetForm:ae}=ke({validationSchema:Z}),$=V("name"),k=V("account"),C=V("email"),A=V("password"),U=V("gender"),E=V("age"),le=ee(async e=>{var a,l;try{const o=new FormData;o.append("name",e.name),o.append("account",e.account),o.append("email",e.email),o.append("age",e.age),o.append("gender",e.gender),e.password.includes("*")?o.append("password",""):o.append("password",e.password),h.value&&o.append("image",h.value),d.value.id.length>0?await x.patch("/user/profile/"+d.value.id,o):await x.post("/user",o),v.splice(0,v.length),R(),f({text:r(d.value.id.length>0?"admin.userEditSuccess":"admin.userCreated"),snackbarProps:{color:"green"}}),P()}catch(o){console.log(o),f({text:r("api."+(((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)||"unknownError")),snackbarProps:{color:"red"}})}}),se=ie(()=>[{text:r("user.genderMale"),value:"男"},{text:r("user.genderFemale"),value:"女"}]),te=Array.from({length:100},(e,a)=>({text:a+1,value:a+1}));return(e,a)=>(de(),me(fe,null,[s(J,{class:"admin__user","max-width":"1440"},{default:t(()=>[s(S,null,{default:t(()=>[s(w,{cols:"11",offset:"0","offset-sm":"0","offset-md":"0","offset-lg":"0","offset-xl":"1"},{default:t(()=>[u("h1",xe,i(e.$t("nav.adminUsers")),1),s(w,{cols:"12"},{default:t(()=>[s(S,{class:"mb-5"},{default:t(()=>[s(w,{cols:"3","align-self":"center"},{default:t(()=>[s(p,{onClick:a[0]||(a[0]=l=>F(null))},{default:t(()=>[m(i(e.$t("admin.userNew")),1)]),_:1})]),_:1}),s(w,{cols:"9",sm:"9",md:"9",lg:"6",xl:"6"},{default:t(()=>[s(b,{modelValue:q.value,"onUpdate:modelValue":a[1]||(a[1]=l=>q.value=l),"prepend-inner-icon":"mdi-magnify",variant:"outlined","max-width":"600"},null,8,["modelValue"])]),_:1})]),_:1}),s(be,{items:v,headers:H,search:q.value},{"item.role":t(({item:l})=>[u("span",null,i(X(l.role)),1)]),"item.edit":t(({item:l})=>[s(p,{onClick:o=>F(l)},{default:t(()=>[m(i(e.$t("admin.userEdit")),1)]),_:2},1032,["onClick"])]),"item.delete":t(({item:l})=>[s(p,{onClick:o=>K(l)},{default:t(()=>[m(i(e.$t("admin.userDelete")),1)]),_:2},1032,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1})]),_:1}),s(L,{modelValue:d.value.open,"onUpdate:modelValue":a[8]||(a[8]=l=>d.value.open=l),"max-width":"500"},{default:t(()=>[s(_e,{disabled:n(M)},{default:t(()=>[s(N,{class:"admin__user-form"},{default:t(()=>[s(pe,null,{default:t(()=>[m(i(e.$t(d.value.id?"admin.userEdit":"admin.userNew")),1)]),_:1}),s(j,{class:"pb-0"},{default:t(()=>[s(J,null,{default:t(()=>[s(S,null,{default:t(()=>[s(w,{cols:"12",class:"d-flex align-center"},{default:t(()=>[s(ce,{size:"x-large"},{default:t(()=>[s(ve,{alt:"John",src:I.value},null,8,["src","alt"])]),_:1}),u("input",{ref_key:"fileInput",ref:y,type:"file",accept:"image/jpeg,image/png",minlength:"1024",onChange:W,class:"d-none"},null,544),s(p,{class:"ml-5",onClick:Q},{default:t(()=>a[12]||(a[12]=[m("變更頭像")])),_:1})]),_:1}),s(w,{cols:"12"},{default:t(()=>[u("div",ye,[u("span",he,i(e.$t("user.email")),1),s(b,{modelValue:n(C).value.value,"onUpdate:modelValue":a[2]||(a[2]=l=>n(C).value.value=l),"error-messages":n(C).errorMessage.value,variant:"outlined","max-width":"300"},null,8,["modelValue","error-messages"])]),u("div",$e,[u("span",Ce,i(e.$t("user.name")),1),s(b,{modelValue:n($).value.value,"onUpdate:modelValue":a[3]||(a[3]=l=>n($).value.value=l),"error-messages":n($).errorMessage.value,counter:"",variant:"outlined","max-width":"300"},null,8,["modelValue","error-messages"])]),u("div",Ae,[u("span",Ue,i(e.$t("user.account")),1),s(b,{modelValue:n(k).value.value,"onUpdate:modelValue":a[4]||(a[4]=l=>n(k).value.value=l),"error-messages":n(k).errorMessage.value,counter:"",variant:"outlined","max-width":"300"},null,8,["modelValue","error-messages"])]),u("div",Ee,[u("span",qe,i(e.$t("user.password")),1),s(b,{modelValue:n(A).value.value,"onUpdate:modelValue":a[5]||(a[5]=l=>n(A).value.value=l),type:"password","error-messages":n(A).errorMessage.value,counter:"",variant:"outlined","max-width":"300"},null,8,["modelValue","error-messages"])]),u("div",De,[u("span",Ie,i(e.$t("user.gender")),1),s(O,{modelValue:n(U).value.value,"onUpdate:modelValue":a[6]||(a[6]=l=>n(U).value.value=l),"error-messages":n(U).errorMessage.value,items:n(se),"item-title":"text","item-value":"value",variant:"outlined","max-width":"300"},null,8,["modelValue","error-messages","items"])]),u("div",Re,[u("span",Se,i(e.$t("user.age")),1),s(O,{modelValue:n(E).value.value,"onUpdate:modelValue":a[7]||(a[7]=l=>n(E).value.value=l),"error-messages":n(E).errorMessage.value,items:n(te),"item-title":"text","item-value":"value",variant:"outlined","max-width":"300"},null,8,["modelValue","error-messages","items"])])]),_:1})]),_:1})]),_:1})]),_:1}),s(B,{class:"mb-3"},{default:t(()=>[s(p,{onClick:P},{default:t(()=>[m(i(e.$t("user.cancel")),1)]),_:1}),s(p,{type:"button",loading:n(M),onClick:n(le)},{default:t(()=>[m(i(e.$t("user.submit")),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),s(L,{modelValue:c.value.open,"onUpdate:modelValue":a[11]||(a[11]=l=>c.value.open=l),width:"350"},{default:t(()=>[s(N,null,{default:t(()=>[s(j,null,{default:t(()=>a[13]||(a[13]=[m("確定要刪除成員嗎?")])),_:1}),s(B,null,{default:t(()=>[s(p,{onClick:a[9]||(a[9]=l=>T("cancel"))},{default:t(()=>a[14]||(a[14]=[m("取消")])),_:1}),s(p,{onClick:a[10]||(a[10]=l=>T("confirm"))},{default:t(()=>a[15]||(a[15]=[m("確定")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};typeof G=="function"&&G(Te);export{Te as default};
