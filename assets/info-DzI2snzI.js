import{u as D,r as c,a as L,i as G,d as J,p as v,k as b,h as l,g as s,s as d,x as n,j as r,az as O,q as W,W as H,V as S,v as V,aq as K,f as Q,y as X,m as k,z as Y}from"./index-DwkSfnf8.js";import{c as Z,a as A,b as ee,u as ae,e as E}from"./index.esm-DLrHeIZi.js";import{b as C}from"./route-block-B_A1xBdJ.js";import{a as m,V as F}from"./VRow-Dv0EYRqv.js";import{V as te}from"./VForm-CtndMy8G.js";import{V as U}from"./VContainer-qPzHuW1w.js";import{V as z}from"./VSelect-B-j9XFUy.js";import"./VList-DdudlTOX.js";import"./VDivider-BGbZjjoE.js";import"./VMenu-DkArp_33.js";import"./VChip-C1fuGo_c.js";const se={class:"d-flex justify-end"},le={__name:"info",setup(re){const{apiAuth:I}=Y(),{t:o}=D(),i=c([]),_=L(),y=G(),w=c("http://api.multiavatar.com/bbb.png"),x=c(null),h=c(null),u=c(!1),M=J(()=>[{text:o("user.genderMale"),value:"男"},{text:o("user.genderFemale"),value:"女"}]),N=Array.from({length:100},(a,e)=>({text:e+1,value:e+1})),R=()=>{x.value.click()},j=async()=>{try{const a=x.value.files[0];if(!a)return;if(!["image/jpeg","image/png"].includes(a.type))throw new Error("userImageInvalid");if(a.size>1024*1024)throw new Error("userImageMaxSize");w.value=URL.createObjectURL(a),h.value=a}catch(a){console.log(a),y({text:o("admin."+(a.message||"unknownError")),snackbarProps:{color:"red"}})}},B=Z({name:A().required(o("api.userNameRequired")),gender:A().required(o("api.userGenderRequired")),age:ee().required(o("api.userAgeRequired"))}),{handleSubmit:P,isSubmitting:$,resetForm:ue}=ae({validationSchema:B}),p=E("name"),f=E("gender"),g=E("age"),T=P(async a=>{try{const e=new FormData;e.append("name",a.name),e.append("age",a.age),e.append("gender",a.gender),h.value&&e.append("image",h.value),await I.patch("/user/profile",e),y({text:o("api.userEditSuccess"),snackbarProps:{color:"green"}}),q(),u.value=!1}catch(e){console.log(e)}}),q=async()=>{var a,e;try{const{data:t}=await I.get("/user/profile");i.value=t.result,console.log(i.value),w.value=i.value.image,p.value.value=i.value.name,g.value.value=i.value.age,f.value.value=i.value.gender,_.setAvatar(t.result.image),_.setNickname(t.result.name)}catch(t){console.log(t),y({text:o("api."+(((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)||"unknownError")),snackbarProps:{color:"red"}})}};return q(),(a,e)=>(v(),b(U,{"max-width":"1440"},{default:l(()=>[s(F,null,{default:l(()=>[s(m,{cols:"11",offset:"1"},{default:l(()=>[d("h1",null,n(a.$t("member.userEdit")),1),s(te,{disabled:r($),onSubmit:O(r(T),["prevent"])},{default:l(()=>[s(U,{class:"member__info"},{default:l(()=>[s(F,null,{default:l(()=>[s(m,{cols:"11",offset:"1",class:"d-flex align-center"},{default:l(()=>[s(W,{size:"70"},{default:l(()=>[s(H,{alt:"John",src:w.value},null,8,["src","alt"])]),_:1}),d("input",{ref_key:"fileInput",ref:x,type:"file",accept:"image/jpeg,image/png",onChange:j,class:"d-none"},null,544),s(S,{class:"ml-5",onClick:R,disabled:!u.value},{default:l(()=>e[5]||(e[5]=[V("變更頭像")])),_:1},8,["disabled"])]),_:1}),s(m,{cols:"11",offset:"1"},{default:l(()=>[s(m,{cols:"12"},{default:l(()=>[d("span",null,n(a.$t("user.name")),1),s(K,{modelValue:r(p).value.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r(p).value.value=t),"error-messages":r(p).errorMessage.value,counter:"",variant:"outlined",disabled:!u.value,"max-width":"300"},null,8,["modelValue","error-messages","disabled"]),d("span",null,n(a.$t("user.gender")),1),s(z,{modelValue:r(f).value.value,"onUpdate:modelValue":e[1]||(e[1]=t=>r(f).value.value=t),"error-messages":r(f).errorMessage.value,items:r(M),"item-title":"text","item-value":"value",variant:"outlined",disabled:!u.value,"max-width":"300"},null,8,["modelValue","error-messages","items","disabled"]),d("span",null,n(a.$t("user.age")),1),s(z,{modelValue:r(g).value.value,"onUpdate:modelValue":e[2]||(e[2]=t=>r(g).value.value=t),"error-messages":r(g).errorMessage.value,items:r(N),"item-title":"text","item-value":"value",variant:"outlined",disabled:!u.value,"max-width":"300"},null,8,["modelValue","error-messages","items","disabled"])]),_:1})]),_:1}),u.value?k("",!0):(v(),b(m,{key:0,cols:"8",offset:"3"},{default:l(()=>[u.value?k("",!0):(v(),Q("button",{key:0,onClick:e[3]||(e[3]=t=>u.value=!0)},[s(X,{icon:"mdi-pencil-outline",size:"large"}),V(" "+n(r(o)("member.userEdit")),1)]))]),_:1})),s(m,{cols:"4"},{default:l(()=>[d("div",se,[u.value?(v(),b(S,{key:0,type:"submit",loading:r($),class:"mr-3"},{default:l(()=>[V(n(a.$t("member.submitEdit")),1)]),_:1},8,["loading"])):k("",!0),u.value?(v(),b(S,{key:1,onClick:e[4]||(e[4]=t=>u.value=!1)},{default:l(()=>[V(n(a.$t("member.cancelEdit")),1)]),_:1})):k("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}))}};typeof C=="function"&&C(le);export{le as default};
