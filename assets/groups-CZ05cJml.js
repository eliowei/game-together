import{u as Be,i as We,ax as ce,r as v,z as He,d as I,w as fe,ai as M,e as ye,o as V,f as q,g as o,h as r,q as i,v as u,V as k,t as m,ao as R,U as Oe,j as n,ap as he,at as je,au as xe,F as O,s as ee,m as Ve,az as Ke,av as be,aw as we,y as Je,k as ke}from"./index-91QIX5EU.js";import{c as _e,a as d,b as ae,d as Qe,u as Xe,e as p}from"./index.esm-Coh-4CUH.js";import{u as Ye}from"./areaData-EWqLwFCW.js";import{G as $e,z as Ze}from"./zh-TW-7lWDpkmx.js";import{B as ea}from"./BlotFormatter-DnX8dSIA.js";import{b as Ce}from"./route-block-B_A1xBdJ.js";import{V as te,a as b}from"./VRow-tN3goQXN.js";import{V as aa}from"./VDataTable-kz_VzJ1B.js";import{V as j}from"./VContainer-BFfq6ZoQ.js";import{V as ta}from"./VForm-BT4eHWvn.js";import{V as la,a as oa,b as le,c as na}from"./VTabs-DUkqiKeD.js";import{V as z}from"./VSelect-BZU2X6bT.js";import{V as qe}from"./VChip-BhzCjzch.js";import"./VPagination-GJFwHWXx.js";import"./VMenu-NnX9fN8q.js";import"./VDivider-Dh8I4qD4.js";import"./VList-BAfCkTK2.js";const ra={class:"text-center mb-5"},sa={class:"d-flex"},ua={class:"mt-3 mr-9"},ia={class:"d-flex"},da={class:"mt-3 mr-5"},ma={class:"d-flex"},pa={class:"mt-3 mr-5"},ga={class:"d-flex"},va={class:"mt-3 mr-5"},ca={class:"mt-3 mr-5"},fa={class:"d-flex"},ya={class:"mt-3 mr-5"},ha={key:0,class:"d-flex"},xa={class:"mt-3 mr-5"},Va={key:1,class:"d-flex"},ba={class:"mt-3 mr-5"},wa={class:"d-flex align-center"},ka={class:"mr-5"},_a={class:"mr-5"},$a={class:"text-center"},Ca={class:"text-center mb-6"},qa={class:"text-center"},Ra={style:{"max-width":"200px"}},za="yyyy'-'MM'-'dd'",Aa="HH':'mm'",Da={__name:"groups",setup(Ua){const{apiAuth:A}=Je(),{t:a}=Be(),{area_data:oe}=Ye(),h=We(),D=ce([]),K=v(""),Re=He(),_=v([]),ne=v([]),J=v(null),re=ce([]),U=v(""),se={modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link"]],BlotFormatter:ea},placeholder:"請輸入內容..."},c=v(0),S=v(5),F=v(""),f=v([]),ze=[{text:a("tag.computer"),value:a("tag.computer")},{text:a("tag.mobile"),value:a("tag.mobile")},{text:a("tag.console"),value:a("tag.console")},{text:a("tag.virtualReality"),value:a("tag.virtualReality")},{text:a("tag.augmentedReality"),value:a("tag.augmentedReality")},{text:a("tag.webGame"),value:a("tag.webGame")},{text:a("tag.Adventure"),value:a("tag.Adventure")},{text:a("tag.RPG"),value:a("tag.RPG")},{text:a("tag.simulation"),value:a("tag.simulation")},{text:a("tag.sportsAndRacing"),value:a("tag.sportsAndRacing")},{text:a("tag.puzzleAndParty"),value:a("tag.puzzleAndParty")},{text:a("tag.musicAndRhythm"),value:a("tag.musicAndRhythm")},{text:a("tag.sandboxAndOpenWorld"),value:a("tag.sandboxAndOpenWorld")},{text:a("tag.scienceFictionAndFantasy"),value:a("tag.scienceFictionAndFantasy")},{text:a("tag.EducationAndExperimental"),value:a("tag.EducationAndExperimental")},{text:a("tag.massiveMultiplayer"),value:a("tag.massiveMultiplayer")}],Ae=[{title:a("group.name"),key:"name",sortable:!0},{title:a("group.organizerName"),key:"organizer_id.name",sortable:!0},{title:a("group.time"),key:"time",sortable:!0},{title:a("group.memberLimit"),key:"member_limit",sortable:!0},{title:a("group.type"),key:"type",sortable:!0},{title:a("group.address"),key:"address",sortable:!0},{title:"",key:"edit",sortable:!1},{title:"",key:"delete",sortable:!1}],Q=I(()=>[{text:a("group.online"),value:"線上"},{text:a("group.offline"),value:"線下"}]);(async()=>{var e,l;try{const{data:s}=await A.get("/user/all");re.push(...s.result)}catch(s){console.log(s),h({text:a("api."+(((l=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:l.message)||"unknownError")),snackbarProps:{color:"red"}})}})();const De=I(()=>re.map(e=>({text:e.name,value:e._id}))),Ue=I(()=>[{text:a("area.taipei"),value:"taipei"},{text:a("area.newTaipei"),value:"newTaipei"},{text:a("area.keeLung"),value:"keeLung"},{text:a("area.taoyuan"),value:"taoyuan"},{text:a("area.hsinchuCounty"),value:"hsinchuCounty"},{text:a("area.hsinchu"),value:"hsinchu"},{text:a("area.miaoli"),value:"miaoli"},{text:a("area.taichung"),value:"taichung"},{text:a("area.nantou"),value:"nantou"},{text:a("area.changhua"),value:"changhua"},{text:a("area.yunlin"),value:"yunlin"},{text:a("area.chiayi"),value:"chiayi"},{text:a("area.chiayiCounty"),value:"chiayiCounty"},{text:a("area.tainan"),value:"tainan"},{text:a("area.kaohsiung"),value:"kaohsiung"},{text:a("area.pingtung"),value:"pingtung"},{text:a("area.yilan"),value:"yilan"},{text:a("area.hualien"),value:"hualien"},{text:a("area.taitung"),value:"taitung"},{text:a("area.penghu"),value:"penghu"},{text:a("area.kinmen"),value:"kinmen"},{text:a("area.lienchiang"),value:"lienchiang"}]),Se=Array.from({length:19},(e,l)=>({text:String(l+2),value:l+2})),X=async()=>{var e,l;try{const{data:s}=await A.get("/group/all");D.push(...s.result)}catch(s){console.log(s),h({text:a("api."+(((l=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:l.message)||"unknownError")),snackbarProps:{color:"red"}})}};X();const g=v({open:!1,id:""}),w=v({open:!1,data:""}),Fe=e=>{w.value.open=!0,w.value.data=e},ue=e=>{e==="cancel"?w.value.open=!1:e==="confirm"&&(Ee(w.value.data),w.value.open=!1)},ie=async e=>{if(e){await M(),g.value.id=e._id,G.value.value=e.organizer_id._id,P.value.value=e.name,L.value.value=e.description,$.value.value=e.type,E.value.value=e.member_limit,N.value.value=e.contact_method,B.value.value=e.contact_info,x.value.value=e.city,await M(),T.value.value=e.region,W.value.value=e.address,Y.value.value=new Date(e.time),H.value.value={hours:new Date(e.time).getHours(),minutes:new Date(e.time).getMinutes()};const l=e.tags.map(s=>({text:s,value:s}));f.value=l,S.value=5-e.tags.length,c.value=2,await M(),U.value=e.content,c.value=0}g.value.open=!0},de=()=>{var e;Ge(),g.value.id="",g.value.open=!1,(e=J.value)!=null&&e.deleteFileRecord&&J.value.deleteFileRecord(),f.value.length=0,S.value=5,U.value=""},Te=I(()=>ze.filter(e=>!f.value.includes(e))),Ie=_e({organizer_id:d().required(a("group.organizerNameRequired")),name:d().required(a("group.nameRequired")),description:d().required(a("group.descriptionRequired")),type:d().required(a("group.typeRequired")),member_limit:ae().required(a("group.memberLimitRequired")),contact_method:d().required().oneOf(["Line","Discord","Facebook"],a("group.contactMethodRequired")),contact_info:d().required(a("group.contactInfoRequired")),city:d().when("type",{is:e=>e===a("group.offline"),then:()=>d().required(a("group.cityRequired")),otherwise:()=>d()}),region:d().when("type",{is:e=>e===a("group.offline"),then:()=>d().required(a("group.regionRequired")),otherwise:()=>d()}),address:d().when("type",{is:e=>e===a("group.offline"),then:()=>d().required(a("group.addressRequired")),otherwise:()=>d()}),date:Qe().required(a("group.dateRequired")),time:_e({hours:ae().required(),minutes:ae().required()}).required(a("group.timeRequired"))}),{handleSubmit:Me,isSubmitting:me,resetForm:Ge,errors:Pe}=Xe({validationSchema:Ie,initialValues:{organizer_id:"",name:"",description:"",type:a("group.online"),member_limit:"5",contact_method:"Line",contact_info:"",city:"taipei",region:a("area.taipei_zhongzheng"),address:"台北市中正區",date:new Date,time:{hours:new Date().getHours(),minutes:new Date().getMinutes()}}}),G=p("organizer_id"),P=p("name"),L=p("description"),$=p("type"),E=p("member_limit"),N=p("contact_method"),B=p("contact_info"),x=p("city"),T=p("region"),W=p("address"),Y=p("date"),H=p("time");fe(Pe,e=>{Object.keys(e).length>0&&(c.value=0)},{deep:!0}),fe(()=>x.value.value,e=>{T.value.value=""});const Le=I(()=>!x.value.value||!oe[x.value.value]?[]:oe[x.value.value].map(e=>({text:e,value:e}))),Ee=async e=>{var l,s;try{await A.delete("/group/"+e._id),D.length=0,await X(),h({text:a("admin.groupDeleted"),snackbarProps:{color:"green"}})}catch(y){console.log(y),h({text:a("api."+(((s=(l=y==null?void 0:y.response)==null?void 0:l.data)==null?void 0:s.message)||"unknownError")),snackbarProps:{color:"red"}})}},pe=[{id:1,title:a("tab.group")},{id:2,title:a("tab.tag")},{id:3,title:a("tab.content")}],ge=e=>{e.value.trim()!==""&&(f.value.length<5&&(f.value.push(e),S.value-=1),F.value="")},ve=e=>{const l=f.value.findIndex(s=>s.value===e.value);l>-1&&f.value.splice(l,1),S.value+=1},Ne=Me(async e=>{var l,s,y;if(!((l=_.value[0])!=null&&l.error)){if(f.value.length===0){c.value=1,await M(),h({text:a("admin.groupTagRequired"),snackbarProps:{color:"red"}});return}else if(g.value.id.length===0&&_.value.length===0){c.value=2,await M(),h({text:a("admin.groupImageRequired"),snackbarProps:{color:"red"}});return}try{const t=new FormData;t.append("organizer_id",e.organizer_id),t.append("name",e.name),t.append("description",e.description),t.append("type",e.type),t.append("member_limit",e.member_limit),t.append("contact_method",e.contact_method),t.append("contact_info",e.contact_info),e.type===a("group.online")?(t.append("city",""),t.append("region",""),t.append("address","")):(t.append("city",e.city),t.append("region",e.region),t.append("address",e.address)),t.append("time",`${Re.format(e.date,"keyboardDate")} ${String(e.time.hours).padStart(2,"0")}:${String(e.time.minutes).padStart(2,"0")}:00`);const C=f.value.map(Z=>Z.value);for(let Z of C)t.append("tags[]",Z);t.append("content",U.value),_.value.length>0&&t.append("image",_.value[0].file),g.value.id.length>0?await A.patch("/group/"+g.value.id,t):await A.post("/group",t),D.splice(0,D.length),X(),h({text:a(g.value.id.length>0?"adminGroup.editSuccess":"adminGroup.newSuccess"),snackbarProps:{color:"green"}}),de()}catch(t){console.log(t),h({text:a("api."+(((y=(s=t.response)==null?void 0:s.data)==null?void 0:y.message)||"unknownError")),snackbarProps:{color:"red"}})}}});return(e,l)=>{const s=ye("quill-editor"),y=ye("VueFileAgent");return V(),q(O,null,[o(j,{class:"admin__group","max-width":"1440"},{default:r(()=>[o(te,null,{default:r(()=>[o(b,{cols:"11",offset:"0","offset-sm":"0","offset-md":"0","offset-lg":"0","offset-xl":"1"},{default:r(()=>[i("h1",ra,u(e.$t("nav.adminGroups")),1),o(b,{cols:"12"},{default:r(()=>[o(te,{class:"mb-5"},{default:r(()=>[o(b,{cols:"3","align-self":"center"},{default:r(()=>[o(k,{onClick:l[0]||(l[0]=t=>ie(null))},{default:r(()=>[m(u(e.$t("admin.groupNew")),1)]),_:1})]),_:1}),o(b,{cols:"9",sm:"9",md:"9",lg:"6",xl:"6"},{default:r(()=>[o(R,{modelValue:K.value,"onUpdate:modelValue":l[1]||(l[1]=t=>K.value=t),"prepend-inner-icon":"mdi-magnify",variant:"outlined","max-width":"600"},null,8,["modelValue"])]),_:1})]),_:1}),o(aa,{items:D,headers:Ae,search:K.value},{"item.image":r(({value:t})=>[o(Oe,{src:t,height:"50"},null,8,["src"])]),"item.time":r(({value:t})=>[m(u(new Date(t).toLocaleString()),1)]),"item.edit":r(({item:t})=>[o(k,{onClick:C=>ie(t)},{default:r(()=>[m(u(e.$t("admin.groupEdit")),1)]),_:2},1032,["onClick"])]),"item.delete":r(({item:t})=>[o(k,{onClick:C=>Fe(t)},{default:r(()=>[m(u(e.$t("admin.groupDelete")),1)]),_:2},1032,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1})]),_:1}),o(we,{modelValue:g.value.open,"onUpdate:modelValue":l[21]||(l[21]=t=>g.value.open=t),"max-width":"800",persistent:""},{default:r(()=>[o(ta,{disable:n(me)},{default:r(()=>[o(he,{class:"admin__group-form"},{default:r(()=>[o(je,null,{default:r(()=>[m(u(e.$t(g.value.id?"adminGroup.edit":"adminGroup.new"))+"-"+u(pe[c.value].title),1)]),_:1}),o(xe,{class:"pb-0"},{default:r(()=>[o(la,{modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=t=>c.value=t),"align-tabs":"star",color:"orange",style:{"border-bottom":"1px solid #eeeeee"}},{default:r(()=>[(V(),q(O,null,ee(pe,t=>o(na,{key:t.id},{default:r(()=>[m(u(t.title),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),o(oa,{modelValue:c.value,"onUpdate:modelValue":l[20]||(l[20]=t=>c.value=t),class:"my-8"},{default:r(()=>[o(le,{value:0},{default:r(()=>[o(j,null,{default:r(()=>[i("div",sa,[i("span",ua,u(e.$t("group.organizerName")),1),o(z,{modelValue:n(G).value.value,"onUpdate:modelValue":l[3]||(l[3]=t=>n(G).value.value=t),items:n(De),"error-messages":n(G).errorMessage.value,"item-title":"text","item-value":"value",variant:"outlined","max-width":"600"},null,8,["modelValue","items","error-messages"])]),i("div",ia,[i("span",da,u(e.$t("group.name")),1),o(R,{modelValue:n(P).value.value,"onUpdate:modelValue":l[4]||(l[4]=t=>n(P).value.value=t),"error-messages":n(P).errorMessage.value,minLength:"1",variant:"outlined","max-width":"600"},null,8,["modelValue","error-messages"])]),i("div",ma,[i("span",pa,u(e.$t("group.description")),1),o(R,{modelValue:n(L).value.value,"onUpdate:modelValue":l[5]||(l[5]=t=>n(L).value.value=t),"error-messages":n(L).errorMessage.value,minLength:"1",variant:"outlined","max-width":"600"},null,8,["modelValue","error-messages"])]),i("div",ga,[i("span",va,u(e.$t("group.createdType")),1),o(z,{modelValue:n($).value.value,"onUpdate:modelValue":l[6]||(l[6]=t=>n($).value.value=t),items:n(Q),"error-messages":n($).errorMessage.value,"item-title":"text","item-value":"value",variant:"outlined",class:"mr-5","max-width":"100"},null,8,["modelValue","items","error-messages"]),i("span",ca,u(e.$t("group.memberLimit")),1),o(z,{modelValue:n(E).value.value,"onUpdate:modelValue":l[7]||(l[7]=t=>n(E).value.value=t),items:n(Se),"error-messages":n(E).errorMessage.value,"item-title":"text","item-value":"value",variant:"outlined","max-width":"100"},null,8,["modelValue","items","error-messages"])]),i("div",fa,[i("span",ya,u(e.$t("group.contactInfo")),1),o(z,{modelValue:n(N).value.value,"onUpdate:modelValue":l[8]||(l[8]=t=>n(N).value.value=t),items:["Line","Discord","Facebook"],"error-messages":n(N).errorMessage.value,variant:"outlined","max-width":"150",class:"mr-5"},null,8,["modelValue","error-messages"]),o(R,{modelValue:n(B).value.value,"onUpdate:modelValue":l[9]||(l[9]=t=>n(B).value.value=t),"error-messages":n(B).errorMessage.value,variant:"outlined","max-width":"430"},null,8,["modelValue","error-messages"])]),n($).value.value===n(Q)[1].value?(V(),q("div",ha,[i("span",xa,u(e.$t("group.createdRegion")),1),o(z,{modelValue:n(x).value.value,"onUpdate:modelValue":l[10]||(l[10]=t=>n(x).value.value=t),"error-messages":n(x).errorMessage.value,items:n(Ue),"item-title":"text","item-value":"value",variant:"outlined","max-width":"150",class:"mr-5"},null,8,["modelValue","error-messages","items"]),o(z,{modelValue:n(T).value.value,"onUpdate:modelValue":l[11]||(l[11]=t=>n(T).value.value=t),"error-messages":n(T).errorMessage.value,items:n(Le),"item-title":"text","item-value":"value",variant:"outlined","max-width":"150",class:"mr-5"},null,8,["modelValue","error-messages","items"])])):Ve("",!0),n($).value.value===n(Q)[1].value?(V(),q("div",Va,[i("span",ba,u(e.$t("group.address")),1),o(R,{modelValue:n(W).value.value,"onUpdate:modelValue":l[12]||(l[12]=t=>n(W).value.value=t),"error-messages":n(W).errorMessage.value,variant:"outlined","max-width":"600"},null,8,["modelValue","error-messages"])])):Ve("",!0),i("div",wa,[i("span",ka,u(e.$t("group.date")),1),o(n($e),{modelValue:n(Y).value.value,"onUpdate:modelValue":l[13]||(l[13]=t=>n(Y).value.value=t),"auto-apply":"","enable-time-picker":!1,"format-locale":n(Ze),"hide-input-icon":"",format:za,"min-date":new Date,style:{"max-width":"300px"},class:"mr-5"},null,8,["modelValue","format-locale","min-date"]),i("span",_a,u(e.$t("group.time")),1),o(n($e),{modelValue:n(H).value.value,"onUpdate:modelValue":l[14]||(l[14]=t=>n(H).value.value=t),"time-picker":"","hide-input-icon":"","select-text":e.$t("group.selectSure"),"cancel-text":e.$t("group.selectCancel"),format:Aa,"error-messages":n(H).errorMessage.value,style:{"max-width":"140px"}},null,8,["modelValue","select-text","cancel-text","error-messages"])])]),_:1})]),_:1}),o(le,{value:1},{default:r(()=>[o(j,{class:"admin__group-form"},{default:r(()=>[i("h1",$a,u(e.$t("admin.groupTag")),1),i("h2",Ca,u(e.$t("admin.groupTagInfo",{variable:S.value})),1),o(te,null,{default:r(()=>[o(b,{cols:"11"},{default:r(()=>[o(R,{modelValue:F.value,"onUpdate:modelValue":l[15]||(l[15]=t=>F.value=t),placeholder:n(a)("admin.groupPlaceHolder"),onKeydown:l[16]||(l[16]=Ke(t=>ge({text:F.value,value:F.value}),["enter"])),variant:"outlined"},null,8,["modelValue","placeholder"])]),_:1}),o(b,{cols:"12"},{default:r(()=>[(V(!0),q(O,null,ee(f.value,t=>(V(),ke(qe,{key:t,class:"mr-2 mb-2 pt-1",variant:"outlined",closable:"",link:"","prepend-icon":"mdi-tag",onClick:C=>ve(t),"onClick:close":C=>ve(t)},{default:r(()=>[m(u(t.text),1)]),_:2},1032,["onClick","onClick:close"]))),128))]),_:1}),o(b,{cols:"12"},{default:r(()=>l[25]||(l[25]=[i("h2",null,"標籤:",-1)])),_:1}),o(b,null,{default:r(()=>[(V(!0),q(O,null,ee(n(Te),t=>(V(),ke(qe,{key:t,class:"mr-2 mb-2 pt-1",variant:"outlined",link:"",onClick:C=>ge(t)},{default:r(()=>[m(u(t.text),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),o(le,{value:2},{default:r(()=>[o(j,null,{default:r(()=>[i("h1",qa,u(e.$t("admin.groupContent")),1),o(s,{theme:"snow",content:U.value,"onUpdate:content":l[17]||(l[17]=t=>U.value=t),toolbar:se.modules.toolbar,options:se,contentType:"html",class:"mb-3"},null,8,["content","toolbar"]),l[26]||(l[26]=i("span",{class:"text-h6 font-weight-bold"},"圖片:",-1)),i("div",Ra,[o(y,{modelValue:_.value,"onUpdate:modelValue":l[18]||(l[18]=t=>_.value=t),"raw-model-value":ne.value,"onUpdate:rawModelValue":l[19]||(l[19]=t=>ne.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":e.$t("fileAgent.helpText"),"error-text":{type:e.$t("fileAgent.errorType"),size:e.$t("fileAgent.errorSize")},ref_key:"fileAgent",ref:J},null,8,["modelValue","raw-model-value","help-text","error-text"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(be,{class:"mb-3"},{default:r(()=>[o(k,{onClick:de},{default:r(()=>[m(u(e.$t("adminGroup.cancel")),1)]),_:1}),o(k,{type:"button",loading:n(me),onClick:n(Ne)},{default:r(()=>[m(u(e.$t("adminGroup.submit")),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["disable"])]),_:1},8,["modelValue"]),o(we,{modelValue:w.value.open,"onUpdate:modelValue":l[24]||(l[24]=t=>w.value.open=t),"max-width":"350"},{default:r(()=>[o(he,null,{default:r(()=>[o(xe,null,{default:r(()=>l[27]||(l[27]=[m("確定要刪除揪團嗎?")])),_:1}),o(be,null,{default:r(()=>[o(k,{onClick:l[22]||(l[22]=t=>ue("cancel"))},{default:r(()=>l[28]||(l[28]=[m("取消")])),_:1}),o(k,{onClick:l[23]||(l[23]=t=>ue("confirm"))},{default:r(()=>l[29]||(l[29]=[m("確定")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};typeof Ce=="function"&&Ce(Da);export{Da as default};
