import{aB as ke,c as Ve,r as D,ax as ee,u as Ce,a as ze,z as Ge,i as Pe,d as C,aC as Ee,o as c,f as v,g as t,h as a,q as i,t as r,v as j,U as T,F as I,s as M,ap as S,au as $,aq as N,p as n,j as G,m as _,V as f,ar as Ie,k as P,at as Ne,ay as Re,av as te,aw as De,n as H,az as le,y as Le}from"./index-BjaNM_QN.js";import{G as Oe}from"./GroupFooter-Cf1GrCHF.js";import{b as ae}from"./route-block-B_A1xBdJ.js";import{V as K,a as L}from"./VRow-BMmgCxXg.js";import{V as W}from"./VContainer-HdMFOH4D.js";import{V as oe}from"./VDivider-BLZho4wF.js";import{V as Ae,a as Te,b as se,c as Me}from"./VTabs-C9YUSFDW.js";import{V as q}from"./VTextarea-Djjb-6DB.js";import{a as Se,V as $e}from"./VList-DuPUGNC4.js";import{V as Be}from"./VChip-CIlqQ4Nu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ue={class:"d-flex d-wrap align-center mb-10"},Fe={class:"d-flex flex-column pl-3 align-center"},je={class:"bg-orange-lighten-5"},Ye={class:"group-content mt-15",style:{"margin-bottom":"100px"}},Ze={class:"d-flex flex-wrap"},Ke={class:"card-content d-flex flex-column"},We={class:"mb-1"},qe={class:"mb-1"},He={class:"mb-1"},Je={key:0,class:"mb-1"},Qe={key:0,class:"d-flex flex-column align-center",style:{width:"260px"}},Xe={class:"ml-6 mt-5 mb-5"},et={class:"d-flex flex-wrap"},tt=["onClick"],lt={class:"mt-3 ml-1"},at={class:"mt-1"},ot={class:H(["d-flex","mb-5","mt-3","w-100"])},st={class:"d-flex flex-column mr-3 ml-5 align-center"},it={class:"mt-1 ml-1"},rt={key:0},nt={key:1,class:"text-grey-lighten-1"},dt={key:0},ut={class:"d-flex justify-end mb-5",style:{"max-width":"600px"}},ct={key:1,class:H(["d-flex","mb-5","mt-3","w-100","ml-16"])},mt={class:"d-flex flex-grow-1 mr-3"},pt={key:0,style:{"max-width":"600px",width:"100%"}},ft={class:"d-flex mb-5 w-100 flex-wrap group__page-edit",style:{"max-width":"600px"}},vt={class:"mt-1 mb-3",style:{"font-size":"14px"}},_t={style:{"font-size":"16px"}},gt={class:"d-flex flex-column ml-5 align-center mr-15"},xt={class:"mt-1 ml-1"},yt={class:"d-flex justify-end mb-5",style:{"max-width":"600px"}},bt={class:"d-flex justify-space-between mb-13 mt-4"},ht={class:"d-flex flex-column"},wt={class:"d-flex"},kt={class:"d-flex flex-column mr-8 align-center"},Vt={class:"d-flex group__page-action"},Ct={__name:"[id]",setup(zt){const{api:ie,apiAuth:h}=Le(),re=ke(),z=Ve(),B=D(0),ne=[{id:0,title:"參與者"},{id:1,title:"留言"}],d=ee({open:!1,type:"",data:{},key:0}),{t:J}=Ce(),u=ze(),b=Ge(),m=Pe(),Y=C(()=>u.favorite_groups.some(o=>o.group_id===l.value._id)),de=C(()=>l.value.groupMembers.some(o=>o.user_id._id===u.id)),O=D(""),w=C(()=>!u.id||b.date(l.value.time)<b.date()),Z=C(()=>b.date(l.value.time)<b.date()?"揪團已結束":u.id?"Write a comment...":"請先登入"),p=ee({id:"",open:!1}),g=D(""),k=D(!1),x=D(!1),ue=o=>{p.id=o,p.open=!0,k.value=!1,g.value=""},ce=async(o,e)=>{try{if(!u.id)throw new Error("LOGIN");x.value=!0,await h.delete("/group/"+e._id+"/comment",{data:{comment_id:e.comments[o]._id}}),await E(),m({text:"刪除留言成功",snackbarProps:{color:"green"}}),x.value=!1}catch(R){console.log(R),R.message==="LOGIN"&&(m({text:"請先登入",snackbarProps:{color:"red"}}),z.push("/login"))}},me=async o=>{try{if(!u.id)throw new Error("LOGIN");x.value=!0,await h.delete("/group/"+o._id+"/replayComment",{data:{comment_id:o.comments[p.id]._id}}),await E(),m({text:"刪除回覆留言成功",snackbarProps:{color:"green"}}),x.value=!1,p.open=!1,p.id="",g.value="",k.value=!1}catch{console.log(error),error.message==="LOGIN"&&(m({text:"請先登入",snackbarProps:{color:"red"}}),z.push("/login"))}},U=()=>{p.open=!1,p.id="",g.value="",k.value=!1},pe=(o,e)=>{console.log(e),k.value=!0,p.id=o,p.open=!0,g.value=e.reply.message},Q=async o=>{try{if(!g.value.trim())throw new Error("EMPTY");if(!u.id)throw new Error("LOGIN");x.value=!0,await h.patch("/group/"+o._id+"/replayComment",{comment_id:o.comments[p.id]._id,message:g.value}),x.value=!1,k.value=!1,p.open=!1,p.id="",g.value="",await E(),m({text:"留言成功",snackbarProps:{color:"green"}})}catch(e){console.log(e),e.message==="EMPTY"?m({text:"留言不可為空",snackbarProps:{color:"red"}}):e.message==="LOGIN"&&(m({text:"請先登入",snackbarProps:{color:"red"}}),z.push("/login"))}},F=C(()=>l.value.groupMembers.some(o=>l.value.organizer_id._id!==u.id&&o.user_id._id===u.id)),fe=C(()=>l.value.organizer_id._id===u.id?"主辦者":F.value?"參與者":"未參加"),ve=C(()=>b.date(l.value.time)<b.date()?"揪團已結束":l.value.organizer_id._id===u.id?"取消揪團":F.value?"已參加揪團":l.value.member_count===l.value.member_limit?"揪團已滿":"參加揪團"),_e=C(()=>b.date(l.value.time)<b.date()),l=D({_id:"",organizer_id:{},name:"",image:"",description:"",content:"",type:"",member_count:0,member_limit:0,contact_method:"",contact_info:"",city:"",region:"",time:"",tags:[],groupMembers:[],comments:[]}),ge=C(()=>[{title:"聯絡方式",icon:"mdi-forum",value:l.value.contact_method},{title:"聯絡資訊",icon:"",value:l.value.contact_info}]),A=(o,e,R)=>{d.open=!0,d.type=o,d.data=e,d.key=R,console.log(d.data)},X=o=>{o==="cancel"?d.open=!1:o==="confirm"&&(d.open=!1,d.type==="kick"?we(d.data):d.type==="commentsDelete"?ce(d.key,d.data):d.type==="commentsReplyDelete"?me(d.data):d.type==="cancelsGroup"&&xe())},xe=async()=>{try{await h.delete("/user/organizerGroup/"+l.value._id),z.push("/group"),m({text:"取消揪團成功",snackbarProps:{color:"green"}})}catch(o){console.log(o)}},E=async()=>{try{const{data:o}=await ie.get("/group/"+re.params.id);l.value=o.result}catch(o){console.log(o)}};E();const ye=async()=>{try{if(b.date(l.value.time)<b.date())throw new Error("END");if(l.value.member_count===l.value.member_limit)throw new Error("Full");if(!u.id)throw new Error("LOGIN");l.value.organizer_id._id===u.id?A("cancelsGroup"):F.value||(await h.post("/user/joinGroup/"+l.value._id),m({text:"參加揪團成功",snackbarProps:{color:"green"}})),await E()}catch(o){console.log(o),o.message==="END"?(m({text:"揪團已結束",snackbarProps:{color:"red"}}),z.push("/group")):o.message==="Full"?m({text:"揪團已滿",snackbarProps:{color:"red"}}):o.message==="LOGIN"&&(m({text:"請先登入",snackbarProps:{color:"red"}}),z.push("/login"))}},be=async()=>{try{if(!u.id)throw new Error("LOGIN");if(!O.value.trim())throw new Error("EMPTY");await h.post("/group/"+l.value._id+"/comment",{content:O.value}),m({text:"留言成功",snackbarProps:{color:"green"}}),O.value="",await E()}catch(o){console.log(o),o.message==="LOGIN"?(m({text:"請先登入",snackbarProps:{color:"red"}}),z.push("/login")):o.message==="EMPTY"&&m({text:"留言不可為空",snackbarProps:{color:"red"}})}},he=async()=>{try{if(!u.id)throw new Error("LOGIN");Y.value?(await h.delete("/user/favoriteGroup/"+l.value._id),u.updateFavoriteGroups(l.value,!0),m({text:"取消收藏成功",snackbarProps:{color:"green"}})):Y.value||(await h.post("/user/favoriteGroup/"+l.value._id),u.updateFavoriteGroups(l,!1),m({text:"收藏成功",snackbarProps:{color:"green"}}))}catch(o){console.log(o),o.message==="LOGIN"&&(m({text:"請先登入",snackbarProps:{color:"red"}}),z.push("/login"))}},we=async o=>{try{if(console.log(l.value._id),l.value.organizer_id._id!==u.id)throw new Error("NOT_ORGANIZER");if(l.value.organizer_id._id===o.user_id._id)throw new Error("ORGANIZER");await h.patch("user/organizerGroup/"+l.value._id+"/kick",{user_id:o.user_id._id}),m({text:"踢除成功",snackbarProps:{color:"green"}}),E()}catch(e){console.log(e),e.message==="NOT_ORGANIZER"?m({text:"您不是主辦者",snackbarProps:{color:"red"}}):e.message==="ORGANIZER"&&m({text:"無法踢除主辦者",snackbarProps:{color:"red"}})}};return(o,e)=>{const R=Ee("dompurify-html");return c(),v(I,null,[t(W,{fluid:"","max-width":"1440"},{default:a(()=>[t(K,null,{default:a(()=>[t(L,{cols:"11",offset:"1"},{default:a(()=>[i("h2",null,r(l.value.name),1),i("div",Ue,[t(j,{size:"50"},{default:a(()=>[t(T,{src:l.value.organizer_id.image},null,8,["src"])]),_:1}),i("div",Fe,[e[13]||(e[13]=i("span",null,"主辦者",-1)),i("span",null,r(l.value.organizer_id.name),1)])])]),_:1})]),_:1})]),_:1}),i("div",je,[t(W,{fluid:"",style:{"max-width":"1440px"}},{default:a(()=>[t(K,null,{default:a(()=>[t(L,{cols:"11",offset:"1",sm:"11","offset-sm":"1",md:"11","offset-md":"1",lg:"11","offset-lg":"1",xl:"11","offset-xl":"1"},{default:a(()=>[i("div",Ye,[i("div",Ze,[t(L,{cols:"12",sm:"12",md:"7",lg:"7",xl:"7"},{default:a(()=>[t(T,{src:l.value.image,"max-height":"400","min-width":"300","max-width":"628","aspect-ratio":"16/9",cover:"",style:{flex:"0 1 628px"}},null,8,["src"])]),_:1}),t(L,{cols:"10",offset:"2",sm:"9","offset-sm":"3",md:"4","offset-md":"0",lg:"4","offset-lg":"0",xl:"4","offset-xl":"0"},{default:a(()=>[(c(!0),v(I,null,M(l.value.tags,s=>(c(),P(Be,{class:"mb-2 mt-1 mr-1",variant:"outlined",color:"orange"},{default:a(()=>[n(r(s),1)]),_:2},1024))),256)),i("div",Ke,[t(S,{width:"260",height:"150"},{default:a(()=>[t($,{class:"d-flex flex-column"},{default:a(()=>[i("span",We,[t(N,{icon:"mdi-calendar-range"}),n(r(l.value.time),1)]),i("span",qe,[t(N,{icon:"mdi-web"}),n(" "+r(l.value.type),1)]),i("span",He,[t(N,{icon:"mdi-forum"}),n(" "+r(l.value.contact_method),1)]),l.value.type==="線下"?(c(),v("span",Je,[t(N,{icon:"mdi-map-marker-outline"}),n(" "+r(G(J)("area."+l.value.city)+l.value.region),1)])):_("",!0),i("span",null,[t(N,{icon:"mdi-account-multiple-outline"}),n(" "+r(l.value.member_limit),1)])]),_:1})]),_:1})]),de.value?(c(),v("div",Qe,[t(f,{class:"mt-3","prepend-icon":"mdi-clipboard-list",style:{width:"160px",height:"40px"},onClick:e[0]||(e[0]=s=>A("contact"))},{default:a(()=>e[14]||(e[14]=[n("聯絡資訊")])),_:1})])):_("",!0)]),_:1})]),t(L,{cols:"10"},{default:a(()=>[Ie(i("div",Xe,null,512),[[R,l.value.content]]),t(oe,{class:"border-opacity-100"}),t(Ae,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=s=>B.value=s),"align-tabs":"star",color:"orange",style:{"border-bottom":"1px solid #eeeeee"},class:"mt-8"},{default:a(()=>[(c(),v(I,null,M(ne,s=>t(Me,{key:s.id},{default:a(()=>[n(r(s.title),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),t(Te,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=s=>B.value=s),class:"my-8"},{default:a(()=>[t(se,{value:0},{default:a(()=>[i("div",et,[(c(!0),v(I,null,M(l.value.groupMembers,s=>(c(),v("div",{class:H(["d-flex flex-column mr-9 align-center pa-5",{"cursor-pointer":l.value.organizer_id._id===G(u).id&&l.value.organizer_id._id!==s.user_id._id,"member-card":l.value.organizer_id._id===G(u).id&&l.value.organizer_id._id!==s.user_id._id}]),onClick:y=>l.value.organizer_id._id===G(u).id&&l.value.organizer_id._id!==s.user_id._id?A("kick",s):null},[t(j,{size:"50"},{default:a(()=>[t(T,{src:s.user_id.image},null,8,["src"])]),_:2},1024),i("span",lt,r(s.user_id.name),1),i("span",at,r(l.value.organizer_id._id===s.user_id._id?"主辦者":"成員"),1)],10,tt))),256))])]),_:1}),t(se,{value:1},{default:a(()=>[(c(!0),v(I,null,M(l.value.comments,(s,y)=>(c(),v(I,null,[i("div",ot,[i("div",st,[t(j,null,{default:a(()=>[t(T,{src:s.user_id.image},null,8,["src"])]),_:2},1024),i("span",it,r(s.user_id.name),1)]),t(S,{class:"pl-7 mr-3",style:{"max-width":"600px",width:"100%"}},{default:a(()=>[t($,{class:"pb-0 pl-2",style:{"font-size":"16px"}},{default:a(()=>[n(r(s.content),1)]),_:2},1024),t(te,null,{default:a(()=>[i("span",null," B"+r(y),1),l.value.organizer_id._id===G(u).id?(c(),v("div",rt,[s.reply?_("",!0):(c(),P(f,{key:0,onClick:V=>ue(y)},{default:a(()=>e[15]||(e[15]=[n("回覆")])),_:2},1032,["onClick"])),s.reply?(c(),v("span",nt,"已回覆")):_("",!0),t(f,{onClick:V=>A("commentsDelete",l.value,y),isLoading:x.value},{default:a(()=>e[16]||(e[16]=[n("刪除")])),_:2},1032,["onClick","isLoading"])])):_("",!0)]),_:2},1024)]),_:2},1024)]),p.open&&p.id===y&&!k.value?(c(),v("div",dt,[t(q,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=V=>g.value=V),placeholder:Z.value,variant:"outlined","max-width":"600","no-resize":"",class:"ml-5",disabled:w.value,onKeydown:le(U,["esc"])},null,8,["modelValue","placeholder","disabled"]),i("div",ut,[t(f,{height:"50",onClick:U,disabled:w.value,class:"mr-3"},{default:a(()=>e[17]||(e[17]=[n("取消")])),_:1},8,["disabled"]),t(f,{height:"50",onClick:e[3]||(e[3]=V=>Q(l.value)),disabled:w.value,loading:x.value},{default:a(()=>e[18]||(e[18]=[n("確定送出")])),_:1},8,["disabled","loading"])])])):_("",!0),s.reply?(c(),v("div",ct,[i("div",mt,[t(N,{icon:"mdi-reply",class:"mr-5 ml-2 mt-10",style:{transform:"rotate(180deg)"}}),p.open&&p.id===y&&k.value?(c(),v("div",pt,[t(q,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=V=>g.value=V),placeholder:Z.value,variant:"solo","max-width":"600","no-resize":"",disabled:w.value,onKeydown:le(U,["esc"]),rows:"3",class:"custom-textarea"},null,8,["modelValue","placeholder","disabled"]),i("div",ft,[t(f,{height:"40",onClick:U,disabled:w.value,class:"mr-3 mb-1"},{default:a(()=>e[19]||(e[19]=[n("取消")])),_:1},8,["disabled"]),t(f,{height:"40",onClick:e[5]||(e[5]=V=>Q(l.value)),disabled:w.value,loading:x.value,class:"mr-3 mb-1",style:{"max-width":"600px"}},{default:a(()=>e[20]||(e[20]=[n("確定送出")])),_:1},8,["disabled","loading"]),t(f,{height:"40",onClick:e[6]||(e[6]=V=>A("commentsReplyDelete",l.value)),disabled:w.value,loading:x.value,class:"mb-1",style:{"max-width":"600px"}},{default:a(()=>e[21]||(e[21]=[n("刪除")])),_:1},8,["disabled","loading"])])])):_("",!0),!k.value||p.open&&p.id!==y&&k.value?(c(),P(S,{key:1,class:"pl-7",style:{"max-width":"600px",width:"100%"}},{default:a(()=>[t($,{class:"d-flex flex-column px-0"},{default:a(()=>[i("span",vt,[n("主辦者 回覆B"+r(y)+" ",1),l.value.organizer_id._id===G(u).id?(c(),P(f,{key:0,variant:"text",onClick:V=>l.value.organizer_id._id===G(u).id?pe(y,s):""},{default:a(()=>e[22]||(e[22]=[n("編輯")])),_:2},1032,["onClick"])):_("",!0)]),i("span",_t,r(s.reply.message),1)]),_:2},1024)]),_:2},1024)):_("",!0),i("div",gt,[t(j,null,{default:a(()=>[t(T,{src:s.reply.author.image},null,8,["src"])]),_:2},1024),i("span",xt,r(s.reply.author.name),1)])])])):_("",!0)],64))),256)),e[24]||(e[24]=i("p",{class:"font-weight-bold ml-5 mb-3"},"發佈留言",-1)),t(q,{modelValue:O.value,"onUpdate:modelValue":e[7]||(e[7]=s=>O.value=s),placeholder:Z.value,variant:"outlined","max-width":"600","no-resize":"",class:"ml-5",disabled:w.value},null,8,["modelValue","placeholder","disabled"]),i("div",yt,[t(f,{height:"50",onClick:be,disabled:w.value,loading:x.value},{default:a(()=>e[23]||(e[23]=[n("確定送出")])),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["modelValue"]),t(oe,{class:"border-opacity-100"})]),_:1})])]),_:1})]),_:1})]),_:1})]),t(W,null,{default:a(()=>[t(K,null,{default:a(()=>[t(L,null,{default:a(()=>[i("div",bt,[i("div",ht,[i("span",null,r(l.value.time),1),i("h2",null,r(l.value.name),1)]),i("div",wt,[i("div",kt,[i("span",null,r(l.value.member_limit-l.value.member_count)+"個空位",1),t(f,{onClick:he,icon:Y.value?"mdi-bookmark":"mdi-bookmark-outline",variant:"text"},null,8,["icon"])]),i("div",Vt,[t(f,{class:"mr-5",height:"50",width:"200",disabled:!0},{default:a(()=>[n(r(fe.value),1)]),_:1}),t(f,{height:"50",width:"200",disabled:_e.value||F.value,onClick:ye},{default:a(()=>[n(r(ve.value),1)]),_:1},8,["disabled"])])])])]),_:1})]),_:1})]),_:1}),t(De,{modelValue:d.open,"onUpdate:modelValue":e[12]||(e[12]=s=>d.open=s),width:"350",opacity:"0"},{default:a(()=>[d.type==="contact"?(c(),P(S,{key:0},{default:a(()=>[t(Ne,{class:"d-flex align-center mb-0 pb-0"},{default:a(()=>[i("span",null,r(G(J)("group.contactInfo")),1),t(Re),t(f,{icon:"mdi-close",variant:"text",onClick:e[9]||(e[9]=s=>d.open=!1)})]),_:1}),t($,{class:"pt-0"},{default:a(()=>[t(Se,{class:"py-0"},{default:a(()=>[(c(!0),v(I,null,M(ge.value,(s,y)=>(c(),P($e,{class:"py-0",key:y},{default:a(()=>[n(r(s.title)+": ",1),s.icon?(c(),P(N,{key:0,icon:s.icon},null,8,["icon"])):_("",!0),n(" "+r(s.value),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):_("",!0),d.type!=="contact"?(c(),P(S,{key:1},{default:a(()=>[t($,null,{default:a(()=>[n(r(d.type==="kick"?"確定要踢除該成員嗎?":d.type==="commentsDelete"?"確定要刪除留言嗎?":d.type==="commentsReplyDelete"?"確定要刪除回覆留言嗎?":d.type==="cancelsGroup"?"確定要取消揪團嗎?":""),1)]),_:1}),t(te,null,{default:a(()=>[t(f,{onClick:e[10]||(e[10]=s=>X("cancel"))},{default:a(()=>e[25]||(e[25]=[n("取消")])),_:1}),t(f,{onClick:e[11]||(e[11]=s=>X("confirm"))},{default:a(()=>e[26]||(e[26]=[n("確定")])),_:1})]),_:1})]),_:1})):_("",!0)]),_:1},8,["modelValue"]),t(Oe)],64)}}};typeof ae=="function"&&ae(Ct);export{Ct as default};
